<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fertiboo — Adubos e Fertilizantes</title>

  <!-- Fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Outfit:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0a0f1e; --bg-2:#0f162b; --glass:rgba(255,255,255,0.06);
      --card:#111a33; --muted:#a8b4cf; --text:#e9efff;
      --brand:#7df58a; --brand-2:#32e6a1; --accent:#ffd166;
      --line:#223055; --danger:#ff5e79; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
      background:linear-gradient(180deg,var(--bg) 0%,var(--bg-2) 100%);overflow-x:hidden}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}

    /* Header */
    .app-header{position:sticky;top:0;z-index:30;display:flex;align-items:center;justify-content:space-between;
      padding:12px 18px;background:rgba(10,15,30,.55);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand img{height:32px}
    .app-nav{display:flex;gap:10px}
    .nav-link{background:var(--glass);color:var(--text);border:1px solid var(--line);
      padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
    .nav-link:hover{border-color:var(--brand)}
    .nav-link[aria-disabled="true"]{opacity:.5;cursor:not-allowed}
    .badge{background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#042414;
      padding:2px 8px;border-radius:999px;font-size:12px;margin-left:6px}

    /* Screens */
    .screen{display:none;padding:28px 16px;max-width:1200px;margin:0 auto}
    .screen.active{display:block;animation:fadeIn .35s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

    /* Buttons */
    .btn{border:0;border-radius:14px;padding:12px 16px;cursor:pointer;font-weight:700;transition:.2s}
    .btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#061217}
    .btn.primary:disabled{opacity:.55;cursor:not-allowed}
    .btn.outline{background:transparent;color:var(--text);border:1px solid var(--line)}
    .link{background:none;border:0;color:var(--muted);cursor:pointer}
    .link:hover{color:#fff}

    /* Form */
    .login-box{background:var(--glass);border:1px solid var(--line);border-radius:18px;
      padding:26px;max-width:560px;margin:42px auto;box-shadow:var(--shadow)}
    .field{display:flex;flex-direction:column;gap:6px;margin:12px 0}
    .field input{background:#0c1327;border:1px solid var(--line);color:var(--text);padding:12px;border-radius:12px}
    .field input:focus{border-color:var(--brand)}
    .muted{color:var(--muted)}
    .invalid{border-color:var(--danger)!important}

    /* Slider */
    .hero{margin-top:8px;background:var(--glass);border:1px solid var(--line);border-radius:18px;overflow:hidden}
    .container{position:relative;height:540px;overflow:hidden}
    .list{display:flex;height:100%;transform:translateX(0);transition:transform .6s}
    .item{min-width:100%;display:grid;grid-template-columns:1.1fr .9fr;align-items:center;gap:16px;padding:28px}
    .car-img{display:flex;align-items:center;justify-content:center}
    .car-img img{max-width:92%;height:auto}
    .content .car-information{color:var(--accent);font-weight:700}
    .content h3{font-family:Outfit,sans-serif;font-size:56px;margin:8px 0}
    .description{color:#cbd5ee;line-height:1.5}
    .arrows{position:absolute;top:50%;left:0;right:0;display:flex;justify-content:space-between;padding:0 12px}
    .icon-btn{background:var(--glass);color:#fff;border:1px solid var(--line);border-radius:12px;width:46px;height:46px;cursor:pointer}
    .indicators{position:absolute;bottom:12px;left:12px;right:12px;display:flex;justify-content:space-between}
    .indicators .number{font-size:28px;color:#b5c2e6}
    .indicators ul{display:flex;gap:8px;list-style:none;margin:0;padding:0}
    .indicators li{width:30px;height:6px;border-radius:999px;background:#314067;opacity:.45}
    .indicators li.active{opacity:1;background:linear-gradient(90deg,var(--brand),var(--brand-2))}

    /* Chips */
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin:14px 0 18px}
    .chip{background:#0c1327;border:1px solid var(--line);color:var(--text);padding:9px 14px;border-radius:999px;cursor:pointer}
    .chip.active{border-color:var(--brand)}

    /* Catalog grid */
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .product-card{background:var(--glass);border:1px solid var(--line);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:10px}
    .product-card img{width:100%;height:170px;object-fit:contain;background:#0c1327;border-radius:12px}
    .product-card .name{font-weight:700}
    .product-card .meta{color:var(--muted);font-size:13px}
    .product-card .desc{color:#cbd5ee;font-size:13px;line-height:1.4;min-height:38px}
    .price{font-weight:800}

    /* Cart */
    .panel{background:var(--glass);border:1px solid var(--line);border-radius:16px;padding:16px;margin-top:12px}
    .panel-title{font-weight:700;margin-bottom:10px}
    .row{display:flex;justify-content:space-between;padding:6px 0}
    .row.total{font-size:22px}
    .line{height:1px;background:var(--line);margin:8px 0}
    .cart-item{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;background:var(--glass);border:1px solid var(--line);border-radius:12px;padding:10px}
    .cart-item img{width:64px;height:64px;object-fit:contain;background:#0c1327;border-radius:10px}
    .cart-item .title{font-weight:700}
    .qty{display:flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:999px;padding:4px 8px;background:#0c1327}
    .qty button{background:var(--glass);color:#fff;border:1px solid var(--line);border-radius:999px;width:28px;height:28px;cursor:pointer}
    .remove{background:transparent;color:var(--danger);border:0;cursor:pointer;font-weight:700}

    /* Pay */
    .pay-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    .pay-card{background:#0c1327;border:1px solid var(--line);border-radius:12px;padding:12px;color:#fff;cursor:pointer}
    .pay-card[aria-checked="true"]{border-color:var(--brand)}

    /* Footer & toast */
    .app-footer{max-width:1200px;margin:24px auto;padding:12px 16px;display:flex;justify-content:space-between;color:var(--muted);border-top:1px solid var(--line)}
    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%) translateY(20px);background:#0c1327;color:#fff;border:1px solid var(--line);padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:.3s;z-index:50}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    /* Responsive */
    @media (max-width:980px){.item{grid-template-columns:1fr}.container{height:auto}.content h3{font-size:44px}}
    @media (max-width:520px){.nav-link{padding:8px 10px}.content h3{font-size:34px}.product-card img{height:150px}}
  </style>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img src="./img/logo-fertiboo.png" alt="Logo Fertiboo" onerror="this.src='https://via.placeholder.com/120x32?text=Fertiboo'">
      <span>Fertiboo</span>
    </div>
    <nav class="app-nav">
      <button class="nav-link" data-target="home" aria-disabled="true">Home</button>
      <button class="nav-link" data-target="catalog" aria-disabled="true">Catálogo</button>
      <button class="nav-link" data-target="cart" aria-disabled="true">Carrinho <span id="cartCount" class="badge">0</span></button>
    </nav>
  </header>

  <!-- LOGIN -->
  <section class="screen active" id="auth">
    <div class="login-box">
      <h1>Bem-vindo ao Fertiboo</h1>
      <p class="muted">Entre para acessar o catálogo e fazer seus pedidos.</p>
      <div class="field"><label for="nome">Nome</label><input id="nome" placeholder="Seu nome" autocomplete="name"></div>
      <div class="field"><label for="email">E-mail</label><input id="email" type="email" placeholder="voce@email.com" autocomplete="email"></div>
      <div class="field"><label for="senha">Senha</label><input id="senha" type="password" placeholder="••••••••" autocomplete="current-password"></div>
      <div class="field"><label for="local">Cidade/Região</label><input id="local" placeholder="Cidade - UF" autocomplete="address-level2"></div>
      <button class="btn primary" id="loginBtn">Entrar</button>
    </div>
  </section>

  <!-- HOME (Slider) -->
  <section class="screen" id="home">
    <h2 class="visually-hidden">Destaques</h2>
    <div class="hero">
      <div class="container">
        <div class="list" id="sliderList">
          <div class="item active">
            <div class="car-img">
              <img src="./img/adubo1.png" alt="Adubo NPK 20-05-20" onerror="this.src='https://via.placeholder.com/480x320?text=NPK+20-05-20'">
            </div>
            <div class="content">
              <p class="car-information">NPK 20-05-20 • 50kg • Entrega rápida</p>
              <h3>Adubo NPK</h3>
              <p class="description">Nutrientes essenciais para diversas culturas com equilíbrio N-P-K.</p>
              <button class="btn outline" data-add="1">➕ Adicionar</button>
            </div>
          </div>
          <div class="item">
            <div class="car-img">
              <img src="./img/adubo2.png" alt="Ureia Agrícola" onerror="this.src='https://via.placeholder.com/480x320?text=Ureia'">
            </div>
            <div class="content">
              <p class="car-information">Ureia • 50kg • 45% N</p>
              <h3>Ureia</h3>
              <p class="description">Alta concentração de nitrogênio para crescimento vigoroso.</p>
              <button class="btn outline" data-add="2">➕ Adicionar</button>
            </div>
          </div>
          <div class="item">
            <div class="car-img">
              <img src="./img/adubo3.png" alt="Fertilizante OrganoMineral" onerror="this.src='https://via.placeholder.com/480x320?text=OrganoMineral'">
            </div>
            <div class="content">
              <p class="car-information">OrganoMineral • Sustentável</p>
              <h3>OrganoMineral</h3>
              <p class="description">Matéria orgânica + minerais para solo saudável.</p>
              <button class="btn outline" data-add="3">➕ Adicionar</button>
            </div>
          </div>
        </div>

        <div class="arrows">
          <button class="icon-btn" id="prev" aria-label="Anterior">❮</button>
          <button class="icon-btn" id="next" aria-label="Próximo">❯</button>
        </div>

        <div class="indicators">
          <div class="number" id="slideNumber">01</div>
          <ul id="slideDots">
            <li class="active"></li>
            <li></li>
            <li></li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- CATÁLOGO -->
  <section class="screen" id="catalog">
    <h2>Catálogo</h2>
    <div id="filters" class="chips" role="tablist" aria-label="Filtros de produtos"></div>
    <div id="productList" class="grid" aria-live="polite"></div>
  </section>

  <!-- CARRINHO -->
  <section class="screen" id="cart">
    <h2>Seu Carrinho</h2>

    <div id="cartItems" class="grid"></div>

    <div class="panel" id="deliveryForm">
      <div class="panel-title">Endereço de entrega</div>
      <div class="grid" style="grid-template-columns:2fr 1fr 1fr;gap:12px">
        <div class="field"><label>Rua</label><input id="endRua" placeholder="Rua/Avenida"></div>
        <div class="field"><label>Número</label><input id="endNum" placeholder="Número"></div>
        <div class="field"><label>Bairro</label><input id="endBairro" placeholder="Bairro"></div>
      </div>
      <div class="grid" style="grid-template-columns:2fr 1fr;gap:12px">
        <div class="field"><label>Cidade</label><input id="endCidade" placeholder="Cidade"></div>
        <div class="field"><label>CEP</label><input id="endCep" placeholder="00000-000" inputmode="numeric"></div>
      </div>
      <small class="muted">Preencha para calcular e confirmar a entrega.</small>
    </div>

    <div class="panel" id="totalsBox">
      <div class="row"><span class="muted">Subtotal</span><strong id="subtotal">R$ 0,00</strong></div>
      <div class="row"><span class="muted">Frete</span><strong id="shipping">R$ 0,00</strong></div>
      <div class="row" id="discountRow" hidden><span class="muted">Desconto Pix</span><strong id="discount">- R$ 0,00</strong></div>
      <div class="line"></div>
      <div class="row total"><span>Total</span><span class="price" id="total">R$ 0,00</span></div>
    </div>

    <div class="panel">
      <div class="panel-title">Pagamento</div>
      <div class="pay-grid" id="payOptions" role="radiogroup" aria-label="Método de pagamento">
        <button class="pay-card" data-method="card" role="radio" aria-checked="false">💳 Cartão de crédito</button>
        <button class="pay-card" data-method="pix" role="radio" aria-checked="false">⚡ Pix (5% OFF)</button>
        <button class="pay-card" data-method="boleto" role="radio" aria-checked="false">🧾 Boleto</button>
      </div>
    </div>

    <button class="btn primary" id="checkoutBtn" disabled>Finalizar pedido</button>
  </section>

  <footer class="app-footer">
    <small>© <span id="year"></span> Fertiboo. Todos os direitos reservados.</small>
    <button class="link" id="logoutBtn">Sair</button>
  </footer>

  <div class="toast" id="toast" role="status" aria-live="polite">Pronto!</div>

  <script>
    // ===== Dados =====
    var produtos = [
      { id: 1, nome: "Adubo NPK 20-05-20", tipo: "NPK", preco: 120.00, img: "./img/adubo1.png", desc: "Equilíbrio N-P-K para diversas culturas." },
      { id: 2, nome: "Ureia Agrícola", tipo: "Nitrogenado", preco: 95.00, img: "./img/adubo2.png", desc: "Alta concentração de nitrogênio (45% N)." },
      { id: 3, nome: "Fertilizante OrganoMineral", tipo: "Organo", preco: 150.00, img: "./img/adubo3.png", desc: "Matéria orgânica + minerais para solo saudável." }
    ];

    // ===== Estado =====
    var user = null;
    var carrinho = [];
    var metodoPagamento = null;
    var endereco = { rua: "", num: "", bairro: "", cidade: "", cep: "" };

    // ===== Utils =====
    function qs(s, el){ return (el||document).querySelector(s); }
    function qsa(s, el){ return Array.prototype.slice.call((el||document).querySelectorAll(s)); }
    function formatarPreco(v){ return "R$ " + v.toFixed(2).replace(".", ","); }
    function toast(msg){
      var t = qs('#toast'); if(!t) return;
      t.textContent = msg; t.classList.add('show');
      clearTimeout(t._t); t._t = setTimeout(function(){ t.classList.remove('show'); }, 2000);
    }
    var safeLS = {
      get: function(k){ try{ return localStorage.getItem(k); }catch(e){ return null; } },
      set: function(k,v){ try{ localStorage.setItem(k,v); }catch(e){} }
    };

    // ===== Persistência =====
    function salvar(){
      safeLS.set('fertiboo_user', JSON.stringify(user));
      safeLS.set('fertiboo_cart', JSON.stringify(carrinho));
      safeLS.set('fertiboo_pay', metodoPagamento || "");
      safeLS.set('fertiboo_end', JSON.stringify(endereco));
    }
    function carregar(){
      try{
        var u = safeLS.get('fertiboo_user');
        var c = safeLS.get('fertiboo_cart');
        var m = safeLS.get('fertiboo_pay');
        var e = safeLS.get('fertiboo_end');
        user = u ? JSON.parse(u) : null;
        carrinho = c ? JSON.parse(c) : [];
        metodoPagamento = m || null;
        endereco = e ? JSON.parse(e) : { rua:"",num:"",bairro:"",cidade:"",cep:"" };
      }catch(err){
        user = null; carrinho = []; metodoPagamento = null; endereco = { rua:"",num:"",bairro:"",cidade:"",cep:"" };
      }
    }

    // ===== Navegação =====
    function mostrarTela(id){
      qsa('.screen').forEach(function(s){ s.classList.remove('active'); });
      var scr = qs('#'+id); if(scr) scr.classList.add('active');
      var disabled = !user;
      qsa('.nav-link').forEach(function(b){ b.disabled = disabled; b.setAttribute('aria-disabled', String(disabled)); });
      atualizarHeader();
      if(id === 'catalog') renderCatalogo();
      if(id === 'cart'){ renderCarrinho(); preencherEnderecoInputs(); bindEnderecoInputs(); updateCheckoutButton(); }
    }
    function atualizarHeader(){
      var count = carrinho.reduce(function(acc, it){ return acc + it.qtd; }, 0);
      var c = qs('#cartCount'); if(c) c.textContent = count;
    }

    // ===== Auth =====
    function initAuth(){
      var btn = qs('#loginBtn'); var out = qs('#logoutBtn');
      if(btn) btn.addEventListener('click', function(){
        var nome = (qs('#nome')||{}).value ? qs('#nome').value.trim() : "";
        var email = (qs('#email')||{}).value ? qs('#email').value.trim() : "";
        var senha = (qs('#senha')||{}).value ? qs('#senha').value.trim() : "";
        var local = (qs('#local')||{}).value ? qs('#local').value.trim() : "";
        if(!nome){ toast('Digite seu nome'); return; }
        if(!email || email.indexOf('@') === -1){ toast('Informe um e-mail válido'); return; }
        if(!senha || senha.length < 4){ toast('Senha mínima de 4 caracteres'); return; }
        user = { nome: nome, email: email, local: local, ts: Date.now() };
        salvar(); toast('Bem-vindo, ' + nome.split(' ')[0] + '!');
        mostrarTela('home');
      });
      if(out) out.addEventListener('click', function(){
        user = null; carrinho = []; metodoPagamento = null; endereco = { rua:"",num:"",bairro:"",cidade:"",cep:"" };
        salvar(); toast('Você saiu da conta.'); mostrarTela('auth');
      });
    }

    // ===== Slider =====
    function initSlider(){
      var list = qs('.list'); if(!list) return;
      var items = qsa('.item', list);
      var dots = qsa('#slideDots li');
      var number = qs('#slideNumber');
      var btnNext = qs('#next'), btnPrev = qs('#prev');
      var index = 0, timer = null;

      function update(){
        list.style.transform = 'translateX(-'+ (index * 100) +'%)';
        dots.forEach(function(d,i){ d.classList.toggle('active', i===index); });
        if(number) number.textContent = String(index+1).padStart(2,'0');
      }
      function next(){ index = (index + 1) % items.length; update(); }
      function prev(){ index = (index - 1 + items.length) % items.length; update(); }

      if(btnNext) btnNext.addEventListener('click', next);
      if(btnPrev) btnPrev.addEventListener('click', prev);
      dots.forEach(function(d,i){ d.addEventListener('click', function(){ index = i; update(); }); });

      function start(){ stop(); timer = setInterval(next, 5000); }
      function stop(){ if(timer){ clearInterval(timer); timer = null; } }
      list.addEventListener('mouseenter', stop);
      list.addEventListener('mouseleave', start);
      start();

      // Add via slider (delegação)
      list.addEventListener('click', function(e){
        var btn = e.target.closest('[data-add]');
        if(!btn) return;
        var id = Number(btn.getAttribute('data-add'));
        adicionarAoCarrinho(id);
      });
    }

    // ===== Catálogo =====
    function montarFiltros(){
      var wrap = qs('#filters'); if(!wrap) return;
      var tipos = ['Todos'].concat(Array.from(new Set(produtos.map(function(p){ return p.tipo; }))));
      wrap.innerHTML = tipos.map(function(t,i){
        return '<button class="chip '+(i===0?'active':'')+'" role="tab" aria-selected="'+(i===0)+'" data-filter="'+t+'">'+t+'</button>';
      }).join('');
    }
    function renderCatalogo(filtro){
      if(typeof filtro === 'undefined') filtro = 'Todos';
      var grid = qs('#productList'); if(!grid) return;
      var lista = produtos.filter(function(p){ return filtro==='Todos' || p.tipo === filtro; });
      if(lista.length === 0){
        grid.innerHTML = '<div class="panel"><span class="muted">Nenhum produto encontrado.</span></div>';
        return;
      }
      grid.innerHTML = lista.map(function(p){
        return '<div class="product-card">\
          <img src="'+p.img+'" alt="'+p.nome+'" onerror="this.src=\'https://via.placeholder.com/320x180?text='+encodeURIComponent(p.nome)+'\'">\
          <div class="name">'+p.nome+'</div>\
          <div class="meta">'+p.tipo+'</div>\
          <p class="desc">'+p.desc+'</p>\
          <div class="price">'+formatarPreco(p.preco)+'</div>\
          <button class="btn primary" data-buy="'+p.id+'">Adicionar</button>\
        </div>';
      }).join('');
    }
    function initCatalogEvents(){
      var filters = qs('#filters'); var grid = qs('#productList');
      if(filters) filters.addEventListener('click', function(e){
        var el = e.target.closest('.chip'); if(!el) return;
        qsa('.chip', filters).forEach(function(c){ c.classList.remove('active'); c.setAttribute('aria-selected','false'); });
        el.classList.add('active'); el.setAttribute('aria-selected','true');
        renderCatalogo(el.getAttribute('data-filter') || 'Todos');
      });
      if(grid) grid.addEventListener('click', function(e){
        var btn = e.target.closest('[data-buy]'); if(!btn) return;
        var id = Number(btn.getAttribute('data-buy'));
        adicionarAoCarrinho(id);
      });
    }

    // ===== Carrinho =====
    function adicionarAoCarrinho(id){
      var prod = produtos.find(function(p){ return p.id === id; });
      if(!prod){ toast('Produto não encontrado'); return; }
      var existente = carrinho.find(function(i){ return i.id === id; });
      if(existente) existente.qtd += 1;
      else carrinho.push({ id: prod.id, nome: prod.nome, preco: prod.preco, img: prod.img, qtd: 1 });
      salvar(); atualizarHeader(); toast(prod.nome+' adicionado');
      if(qs('#cart') && qs('#cart').classList.contains('active')) renderCarrinho();
    }
    function alterarQtd(id, delta){
      var item = carrinho.find(function(i){ return i.id === id; }); if(!item) return;
      item.qtd += delta; if(item.qtd <= 0) carrinho = carrinho.filter(function(i){ return i.id !== id; });
      salvar(); atualizarHeader(); renderCarrinho();
    }
    function removerItem(id){
      carrinho = carrinho.filter(function(i){ return i.id !== id; });
      salvar(); atualizarHeader(); renderCarrinho(); toast('Item removido');
    }
    function calcularTotais(){
      var subtotal = carrinho.reduce(function(acc, it){ return acc + it.preco * it.qtd; }, 0);
      var shipping = subtotal > 300 ? 0 : (subtotal > 0 ? 25 : 0);
      var descontoPix = (metodoPagamento === 'pix') ? subtotal * 0.05 : 0;
      var total = Math.max(0, subtotal + shipping - descontoPix);
      return { subtotal: subtotal, shipping: shipping, descontoPix: descontoPix, total: total };
    }
    function renderCarrinho(){
      var wrap = qs('#cartItems'); if(!wrap) return;
      if(carrinho.length === 0){
        wrap.innerHTML = '<div class="panel"><span class="muted">Seu carrinho está vazio.</span></div>';
      } else {
        wrap.innerHTML = carrinho.map(function(i){
          return '<div class="cart-item">\
            <img src="'+i.img+'" alt="'+i.nome+'" onerror="this.src=\'https://via.placeholder.com/64?text=%20\'">\
            <div>\
              <div class="title">'+i.nome+'</div>\
              <div class="muted">'+formatarPreco(i.preco)+' • '+i.qtd+' un.</div>\
              <button class="remove" data-remove="'+i.id+'">Remover</button>\
            </div>\
            <div class="qty">\
              <button data-dec="'+i.id+'" aria-label="Diminuir">-</button>\
              <span>'+i.qtd+'</span>\
              <button data-inc="'+i.id+'" aria-label="Aumentar">+</button>\
            </div>\
          </div>';
        }).join('');
      }
      var tot = calcularTotais();
      qs('#subtotal').textContent = formatarPreco(tot.subtotal);
      qs('#shipping').textContent = formatarPreco(tot.shipping);
      var discountRow = qs('#discountRow');
      if(tot.descontoPix > 0){
        discountRow.hidden = false;
        qs('#discount').textContent = '- ' + formatarPreco(tot.descontoPix);
      } else {
        discountRow.hidden = true;
      }
      qs('#total').textContent = formatarPreco(tot.total);
      updateCheckoutButton();
    }
    function initCartEvents(){
      var wrap = qs('#cartItems');
      if(wrap) wrap.addEventListener('click', function(e){
        var dec = e.target.closest('[data-dec]'); var inc = e.target.closest('[data-inc]'); var rem = e.target.closest('[data-remove]');
        if(dec){ alterarQtd(Number(dec.getAttribute('data-dec')), -1); }
        if(inc){ alterarQtd(Number(inc.getAttribute('data-inc')), +1); }
        if(rem){ removerItem(Number(rem.getAttribute('data-remove'))); }
      });
    }

    // ===== Endereço =====
    function preencherEnderecoInputs(){
      var r = qs('#endRua'), n = qs('#endNum'), b = qs('#endBairro'), c = qs('#endCidade'), p = qs('#endCep');
      if(!r) return;
      r.value = endereco.rua || "";
      n.value = endereco.num || "";
      b.value = endereco.bairro || "";
      c.value = endereco.cidade || (user && user.local ? user.local : "");
      p.value = endereco.cep || "";
    }
    function bindEnderecoInputs(){
      var form = qs('#deliveryForm'); if(!form || form.dataset.bound) return;
      form.dataset.bound = "1";
      ['endRua','endNum','endBairro','endCidade','endCep'].forEach(function(id){
        var el = qs('#'+id); if(!el) return;
        el.addEventListener('input', function(){
          endereco.rua = (qs('#endRua')||{}).value || "";
          endereco.num = (qs('#endNum')||{}).value || "";
          endereco.bairro = (qs('#endBairro')||{}).value || "";
          endereco.cidade = (qs('#endCidade')||{}).value || "";
          endereco.cep = (qs('#endCep')||{}).value || "";
          salvar(); updateCheckoutButton();
        });
      });
    }
    function cepNumeros(cep){ return (cep||"").replace(/\D/g,''); }
    function enderecoValido(){
      var ok = true;
      var r = qs('#endRua'), n = qs('#endNum'), b = qs('#endBairro'), c = qs('#endCidade'), p = qs('#endCep');
      [r,n,b,c,p].forEach(function(el){ if(!el) return; el.classList.remove('invalid'); });
      if(!endereco.rua || endereco.rua.length < 3){ if(r) r.classList.add('invalid'); ok = false; }
      if(!endereco.num || endereco.num.length < 1){ if(n) n.classList.add('invalid'); ok = false; }
      if(!endereco.bairro || endereco.bairro.length < 2){ if(b) b.classList.add('invalid'); ok = false; }
      if(!endereco.cidade || endereco.cidade.length < 2){ if(c) c.classList.add('invalid'); ok = false; }
      var cep = cepNumeros(endereco.cep);
      if(cep.length < 8){ if(p) p.classList.add('invalid'); ok = false; }
      return ok;
    }
    function updateCheckoutButton(){
      var btn = qs('#checkoutBtn'); if(!btn) return;
      var hasItems = carrinho.length > 0;
      var hasPay = !!metodoPagamento;
      var hasAddr = (endereco.rua && endereco.num && endereco.bairro && endereco.cidade && cepNumeros(endereco.cep).length >= 8);
      btn.disabled = !(hasItems && hasPay && hasAddr);
    }

    // ===== Pagamento =====
    function initPagamento(){
      var wrap = qs('#payOptions');
      if(wrap) wrap.addEventListener('click', function(e){
        var btn = e.target.closest('.pay-card'); if(!btn) return;
        qsa('.pay-card', wrap).forEach(function(b){ b.setAttribute('aria-checked','false'); });
        btn.setAttribute('aria-checked','true');
        metodoPagamento = btn.getAttribute('data-method');
        salvar(); renderCarrinho();
      });
      var chk = qs('#checkoutBtn');
      if(chk) chk.addEventListener('click', function(){
        if(carrinho.length === 0){ toast('Carrinho vazio'); return; }
        if(!metodoPagamento){ toast('Escolha um método de pagamento'); return; }
        if(!enderecoValido()){ toast('Corrija o endereço de entrega'); updateCheckoutButton(); return; }
        var tot = calcularTotais();
        toast('Pedido confirmado! Total '+formatarPreco(tot.total)+' via '+metodoPagamento.toUpperCase());
        carrinho = []; salvar(); atualizarHeader(); renderCarrinho();
      });
    }

    // ===== Header Nav =====
    function initNav(){
      qsa('.nav-link').forEach(function(btn){
        btn.addEventListener('click', function(){
          var target = btn.getAttribute('data-target');
          if(!user){ toast('Faça login para navegar'); mostrarTela('auth'); return; }
          mostrarTela(target);
        });
      });
    }

    // ===== Boot =====
    function boot(){
      carregar();
      var y = qs('#year'); if(y) y.textContent = new Date().getFullYear();
      initNav(); initAuth(); initSlider(); montarFiltros(); initCatalogEvents(); initPagamento(); initCartEvents();
      atualizarHeader();
      if(user){
        mostrarTela('home');
        if(metodoPagamento){
          var btn = qs('.pay-card[data-method="'+metodoPagamento+'"]');
          if(btn) btn.setAttribute('aria-checked','true');
        }
      }else{
        mostrarTela('auth');
      }
    }
    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
```